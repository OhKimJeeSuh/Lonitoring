# ğŸ–¨ï¸Lonitoring

## ëª©ì°¨
**1. í”„ë¡œì íŠ¸ ê°œìš”**  
**2. íŒ€ì›ì†Œê°œ**  
**3. ê°œë°œ í™˜ê²½**   
**4. ì£¼ìš” ê¸°ëŠ¥**  
ã€€      **4-1.** ì„œë²„ ë¦¬ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§  
ã€€      **4-2.** ë³´ì•ˆ ì´ë²¤íŠ¸ ëª¨ë‹ˆí„°ë§  
ã€€      **4-3.** cron í™œìš©  
**5. ì‹¤í–‰**  
ã€€      **5-1.** ì„œë²„ ë¦¬ì†ŒìŠ¤  
ã€€      **5-2.** Login Failed
ã€€      **5-3.** ê²°ê³¼ í™”ë©´ë©´
**6. ğŸ’£ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…**  
**7. ğŸ•¯ï¸ê³ ì°°**  
<br><br><br>


## 1. í”„ë¡œì íŠ¸ ê°œìš”
>  ì´ í”„ë¡œì íŠ¸ëŠ” ì„œë²„ì˜ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ë° ë³´ì•ˆ ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì§‘, ì €ì¥í•˜ì—¬ ì¸í”„ë¼ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•œë‹¤. ë¦¬ì†ŒìŠ¤ëŠ” CPU, ë©”ëª¨ë¦¬, ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ì„, ë³´ì•ˆ ì´ë²¤íŠ¸ëŠ” ë¡œê·¸ì¸ ì‹¤íŒ¨ë¥¼ ìˆ˜ì§‘í•˜ë©°, cronì„ í™œìš©í•´ ì¼ì • ì£¼ê¸°ë¡œ í•´ë‹¹ ë°ì´í„°ë¥¼ logë¡œ ê¸°ë¡í•˜ê³  ë¶„ì„í•œë‹¤. 
 ì´ë¥¼ í†µí•´ ë¦¬ëˆ…ìŠ¤ ëª…ë ¹ì–´ ë° ì‹œìŠ¤í…œ ê´€ë¦¬ ìŠ¤í‚¬ì„ í•™ìŠµí•˜ë©°, ì„œë²„ì˜ ì„±ëŠ¥ ìµœì í™” ë° ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œ ê´€ë¦¬  ë° ë³´ì•ˆ ìš´ì˜ì— ëŒ€í•œ ì¸ì‚¬ì´íŠ¸ë¥¼ í–¥ìƒì‹œí‚¤ê³ , ë¡œê·¸ ë¶„ì„ì„ í†µí•œ ë¬¸ì œ í•´ê²° ì—­ëŸ‰ì„ ê°•í™”í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•œë‹¤.

## 2. íŒ€ì› ì†Œê°œ

## 3. ê°œë°œ í™˜ê²½

| í•­ëª©               | ìƒì„¸ ë‚´ìš©                |
|--------------------|-------------------------|
| **ê°€ìƒí™” í™˜ê²½**    | VMware                  |
| **VM ìš´ì˜ì²´ì œ**    | Ubuntu 22.04.2 LTS      |
| **ì›ê²© ì ‘ì† ë„êµ¬** | MobaXterm               |
| **ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í™˜ê²½** | Bash Shell           |
| **ë¡œê·¸ ì €ì¥ ìœ„ì¹˜** | `/var/log/` ë””ë ‰í† ë¦¬    |


## 4. ì£¼ìš” ê¸°ëŠ¥
### 4-1. ì„œë²„ ë¦¬ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§
- CPU, ë©”ëª¨ë¦¬, ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ì„ ì¼ì • ì£¼ê¸°ë¡œ ê¸°ë¡
- ë¦¬ëˆ…ìŠ¤ ëª…ë ¹ì–´: top, free, df í™œìš©

### 4-2. ë³´ì•ˆ ì´ë²¤íŠ¸ ëª¨ë‹ˆí„°ë§
- SSH ë¡œê·¸ì¸ ì‹¤íŒ¨ ê¸°ë¡
- ë¦¬ëˆ…ìŠ¤ ëª…ë ¹ì–´: grep "Failed passwordâ€

### 4-3. cron í™œìš©
- 1ì´ˆ ì£¼ê¸°ë¡œ ë¦¬ì†ŒìŠ¤ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì—¬ cpu_info.logì— ì €ì¥
- 1ë¶„ ì£¼ê¸°ë¡œ ë¡œê·¸ì¸ ì‹¤íŒ¨ ê¸°ë¡ì„ auth.logì—ì„œ ê°€ì ¸ì™€ failed_login/í˜„ì¬ ë‚ ì§œ.logì— ì €ì¥

## 5. ì‹¤í–‰
### 5-1. ì„œë²„ ë¦¬ì†ŒìŠ¤
**ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰ ì €ì¥ ìŠ¤í¬ë¦½íŠ¸**
> 1ì´ˆì— í•œ ë²ˆì”© CPU ì‚¬ìš©ëŸ‰, CPU ì½”ì–´ ìˆ˜, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰, CPU ë¶€í•˜, ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ì„ ì¶œë ¥í•˜ì—¬ ì €ì¥í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸


```
#!/bin/bash

# ë¡œê·¸ íŒŒì¼ ê²½ë¡œ
LOG_FILE="/var/log/cpu_info.log"

#ë°˜ë³µ íšŸìˆ˜ ì„¤ì • (60ë²ˆ)
MAX_COUNT=60

#ë°˜ë³µ ë³€ìˆ˜
COUNT=0


# ë°˜ë³µë¬¸
while [ $COUNT -lt $MAX_COUNT ]
do
    # í˜„ì¬ ì‹œê°„
    TIMESTAMP=$(date "+%Y-%m-%d %H:%M:%S")

    # CPU ì‚¬ìš©ë¥ 
    CPU_USAGE=$(top -bn1 | grep "Cpu(s)" | awk '{print $2 + $4}')

    # CPU ì½”ì–´ ìˆ˜
    CPU_CORES=$(nproc)

    # ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
    MEMORY_USAGE=$(free -h | grep Mem | awk '{print $3 "/" $2}')

    # uptime (ë¡œë“œ í‰ê· )
    LOAD_AVG=$(uptime | awk -F'load average:' '{print $2}')

    # ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ (ë£¨íŠ¸ ë””ë ‰í† ë¦¬)
    DISK_USAGE=$(df -h / | awk 'NR==2 {print $5}')

    # ë¡œê·¸ ê¸°ë¡
    echo "$TIMESTAMP | CPU ì‚¬ìš©ë¥ : $CPU_USAGE% | ì½”ì–´ ìˆ˜: $CPU_CORES | ë¡œë“œ í‰ê· : $LOAD_AVG | ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰: $DISK_USAGE | ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ : $MEMORY_USAGE" >> $LOG_FILE

    # 1ì´ˆ ëŒ€ê¸°
    sleep 1

    # ë°˜ë³µ íšŸìˆ˜ ì¦ê°€
    COUNT=$((COUNT + 1))
done
```

**ë¦¬ì†ŒìŠ¤ ê¸°ë¡ cron ì„¤ì •**
```
* * * * * /root/linux_practice/cpu_info.sh
```


### 5-2. Login Failed
**ë¡œê·¸ì¸ ì‹¤íŒ¨ ì €ì¥ ìŠ¤í¬ë¦½íŠ¸**
> auth.logì— ì €ì¥ëœ â€œFailed passwordâ€ ë¡œê·¸ë¥¼ ë°›ì•„ì™€ ë¡œê·¸ì¸ ì‹¤íŒ¨ ê¸°ë¡ë§Œ ì €ì¥ëœ ìƒˆë¡œìš´ logíŒŒì¼ì„ ìƒì„±í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸

```
#!/bin/bash

# ì„¤ì •
LOG_DIR="/home/ubuntu/failed_login"
TODAY=$(date +%y%m%d)
LOG_FILE="$LOG_DIR/$TODAY.log"

# ë””ë ‰í† ë¦¬ê°€ ì—†ìœ¼ë©´ ìƒì„±
mkdir -p "$LOG_DIR"

# ì˜¤ëŠ˜ ë‚ ì§œì˜ íƒ€ì„ìŠ¤íƒ¬í”„ íŒ¨í„´ (2025-03-18 í˜•ì‹)
TODAY_DATE_PATTERN=$(date +"%Y-%m-%d")

# auth.logì—ì„œ ì˜¤ëŠ˜ ë‚ ì§œì˜ Failed password ë¡œê·¸ë§Œ ì¶”ì¶œ
grep "Failed password" /var/log/auth.log | grep "$TODAY_DATE_PATTERN" > "$LOG_FILE.today"

# í˜„ì¬ ë¡œê·¸ íŒŒì¼ì´ ìˆìœ¼ë©´ ì¤‘ë³µ ì œê±°ë¥¼ ìœ„í•´ ë¹„êµ
if [ -f "$LOG_FILE" ]; then
  # ìƒˆ ë¡œê·¸ì—ì„œ ê¸°ì¡´ ë¡œê·¸ì— ì—†ëŠ” í•­ëª©ë§Œ ì¶”ì¶œ
  comm -13 <(sort "$LOG_FILE") <(sort "$LOG_FILE.today") > "$LOG_FILE.new"
else
  # íŒŒì¼ì´ ì—†ìœ¼ë©´ ëª¨ë“  ì˜¤ëŠ˜ ë¡œê·¸ë¥¼ ìƒˆ ë¡œê·¸ë¡œ ê°„ì£¼
  cp "$LOG_FILE.today" "$LOG_FILE.new"
fi

# ìƒˆ ë¡œê·¸ê°€ ìˆìœ¼ë©´ ì¶”ê°€
if [ -s "$LOG_FILE.new" ]; then
  cat "$LOG_FILE.new" >> "$LOG_FILE"
  echo "$(date '+%Y-%m-%d %H:%M:%S') - ìƒˆ ë¡œê·¸ $(wc -l < "$LOG_FILE.new")ê°œ ì¶”ê°€ë¨" >> "$LOG_DIR/monitor.log"
else
  echo "$(date '+%Y-%m-%d %H:%M:%S') - ìƒˆ ë¡œê·¸ ì—†ìŒ" >> "$LOG_DIR/monitor.log"
fi

# ì„ì‹œ íŒŒì¼ ì •ë¦¬
rm -f "$LOG_FILE.today" "$LOG_FILE.new"
```

**ë¡œê·¸ì¸ ì‹¤íŒ¨ ê¸°ë¡ cron ì„¤ì •**
```
* * * * * /home/ubuntu/failed_login/failed_login_monitor.sh
```



### 5-3. ê²°ê³¼ í™”ë©´

**ë¡œê·¸ì¸ ì‹¤íŒ¨ ê¸°ë¡ ê²°ê³¼ í™”ë©´**
- í˜„ì¬ ë¡œê·¸ ê¸°ë¡
  ![Image](https://github.com/user-attachments/assets/d533333e-b889-4d4c-82f8-22c6838b37be) <br>

- í˜„ ì‹œê°„ë³´ë‹¤ ë’¤ì˜ log ë°œìƒ ì‹œ ê¸°ë¡ â†’ 1ë¶„ ë‹¨ìœ„ë¡œ ëª¨ë‹ˆí„°ë§
  ![Image](https://github.com/user-attachments/assets/25da3d0a-6367-4cb5-bdd4-36fbecd52282) <br>

- ì¶”ê°€ëœ ë¡œê·¸ ê¸°ë¡
  ![Image](https://github.com/user-attachments/assets/6b4e0901-a9a5-4a89-868e-ad9131b07434) <br>


## 6. íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

## 7. ê³ ì°°
